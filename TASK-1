import pandas as pd
import re
import gc
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.svm import LinearSVC
from sklearn.metrics import accuracy_score, classification_report


def clean_text(text):
    text = text.lower()
    text = re.sub(r'[^a-z\s]', ' ', text)
    text = re.sub(r'\s+', ' ', text)
    return text.strip()


train_df = pd.read_csv(
    "train_data.txt",
    sep=" ::: ",
    engine="python",
    names=["id", "title", "genre", "description"]
)

train_df["description"] = train_df["description"].apply(clean_text)
train_df["genre"] = train_df["genre"].str.strip().str.lower()


test_df = pd.read_csv(
    "test_data.txt",
    sep=" ::: ",
    engine="python",
    names=["id", "title", "description"]
)

test_df["description"] = test_df["description"].apply(clean_text)


test_solution_df = pd.read_csv(
    "test_data_solution.txt",
    sep=" ::: ",
    engine="python",
    names=["id", "title", "genre", "description"]
)

test_solution_df["genre"] = test_solution_df["genre"].str.strip().str.lower()


tfidf = TfidfVectorizer(
    stop_words="english",
    max_features=5000,   
    ngram_range=(1, 2)   
)

X_train = tfidf.fit_transform(train_df["description"])
y_train = train_df["genre"]

del train_df
gc.collect()

X_test = tfidf.transform(test_df["description"])
y_true = test_solution_df["genre"].values



svm_model = LinearSVC(
    C=1.0,       
    max_iter=5000
)

svm_model.fit(X_train, y_train)


y_pred = svm_model.predict(X_test)


accuracy = accuracy_score(y_true, y_pred)

print("\nModel Accuracy:", round(accuracy * 100, 2), "%\n")

print("Classification Report:\n")
print(classification_report(
    y_true,
    y_pred,
    zero_division=0
))


new_plot = """
A former police officer hunts a serial killer while uncovering
a conspiracy that threatens his life and sanity.
"""

new_plot = clean_text(new_plot)
new_vec = tfidf.transform([new_plot])

print("Predicted Genre for New Movie:", svm_model.predict(new_vec)[0])
